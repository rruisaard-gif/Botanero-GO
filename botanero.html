<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="theme-color" content="#0a0a0a" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta name="apple-mobile-web-app-title" content="Botanero?" />
  <title>ğŸ¸ Botanero?</title>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;600;700;800;900&display=swap" rel="stylesheet" />

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, doc, onSnapshot, setDoc, deleteDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBpgnHdJUhWplEPfKWv_eUcCYaXiZ9cib8",
      authDomain: "botanero-3a039.firebaseapp.com",
      projectId: "botanero-3a039",
      storageBucket: "botanero-3a039.firebasestorage.app",
      messagingSenderId: "621952941631",
      appId: "1:621952941631:web:e12fd3f95536c0970e828a"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);
    window.__db        = db;
    window.__fsDoc     = doc;
    window.__fsSnap    = onSnapshot;
    window.__fsSet     = setDoc;
    window.__fsDel     = deleteDoc;
    window.__fsColl    = collection;
    window.__fsGetDocs = getDocs;
    window.__fbReady   = true;
    window.dispatchEvent(new Event("firebase-ready"));
  </script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body, #root { height: 100%; }
    body {
      background: #1e6b3a;
      font-family: 'DM Sans', sans-serif;
      overflow-x: hidden;
    }
    @keyframes float    { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-10px)} }
    @keyframes fadeUp   { from{opacity:0;transform:translateY(24px)} to{opacity:1;transform:translateY(0)} }
    @keyframes pop      { 0%{transform:scale(.85);opacity:0} 70%{transform:scale(1.05)} 100%{transform:scale(1);opacity:1} }
    @keyframes shake    { 0%,100%{transform:rotate(0)} 20%{transform:rotate(-10deg)} 40%{transform:rotate(10deg)} 60%{transform:rotate(-6deg)} 80%{transform:rotate(6deg)} }
    @keyframes blink    { 0%,100%{opacity:1} 50%{opacity:0.2} }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const USERS = ["Robert", "Nino", "Zjevaun", "Coen"];
    const LOGO  = "https://ripsnorter.nl/cdn/shop/files/Ripsnorter_Logo_White_Outline.png?v=1683709923";

    function getTodayKey() {
      const d = new Date();
      return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
    }

    function useVotes() {
      const [votes, setVotes] = useState({});
      const [ready, setReady] = useState(false);
      useEffect(() => {
        let unsub;
        function subscribe() {
          const today = getTodayKey();
          unsub = window.__fsSnap(
            window.__fsDoc(window.__db, "botanero", today),
            snap => { setVotes(snap.exists() ? (snap.data().votes||{}) : {}); setReady(true); }
          );
          cleanOldVotes(today);
        }
        if (window.__fbReady) subscribe();
        else window.addEventListener("firebase-ready", subscribe, {once:true});
        return () => unsub && unsub();
      }, []);

      async function castVote(user, choice) {
        const today = getTodayKey();
        const newVotes = choice === null
          ? Object.fromEntries(Object.entries({...votes}).filter(([k])=>k!==user))
          : {...votes, [user]: choice};
        await window.__fsSet(window.__fsDoc(window.__db,"botanero",today),{votes:newVotes,date:today});
      }
      return { votes, ready, castVote };
    }

    async function cleanOldVotes(today) {
      try {
        const snap = await window.__fsGetDocs(window.__fsColl(window.__db,"botanero"));
        snap.forEach(d=>{ if(d.id!==today) window.__fsDel(window.__fsDoc(window.__db,"botanero",d.id)); });
      } catch {}
    }

    // â”€â”€ LOGO HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function Header() {
      return (
        <div style={{textAlign:"center", padding:"36px 24px 20px"}}>
          <img src={LOGO} alt="Ripsnorter" style={{width:160, opacity:1, filter:"drop-shadow(0 4px 12px rgba(0,0,0,.3))"}}/>
        </div>
      );
    }

    // â”€â”€ PICK USER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function PickUserScreen({ onPick }) {
      return (
        <div style={S.page}>
          <Header/>
          <div style={{flex:1, display:"flex", flexDirection:"column", alignItems:"center", padding:"0 24px 40px", animation:"fadeUp .4s ease forwards"}}>
            <div style={S.card}>
              <div style={{fontWeight:800, fontSize:13, color:"#999", letterSpacing:2, textTransform:"uppercase", marginBottom:16}}>Who are you?</div>
              <div style={{display:"flex", flexDirection:"column", gap:10}}>
                {USERS.map((u,i) => (
                  <button key={u} onClick={()=>onPick(u)} style={{
                    ...S.userBtn,
                    animationDelay:`${i*0.07}s`,
                    animation:"fadeUp .4s ease both",
                  }}>
                    {u}
                  </button>
                ))}
              </div>
            </div>
          </div>
        </div>
      );
    }

    // â”€â”€ VOTE SCREEN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function VoteScreen({ user, votes, onVote }) {
      if (votes[user]) return <ResultsScreen user={user} votes={votes} onVote={onVote}/>;
      return (
        <div style={S.page}>
          <Header/>
          <div style={{flex:1, display:"flex", flexDirection:"column", alignItems:"center", padding:"0 24px 40px", maxWidth:420, margin:"0 auto", width:"100%", animation:"fadeUp .35s ease forwards"}}>

            <div style={S.card}>
              <div style={{fontWeight:900, fontSize:22, color:"#111", marginBottom:4}}>Are you in for Botanero today? ğŸ¸</div>
              <div style={{fontSize:14, color:"#999", marginBottom:24}}>Hey {user}, what do you say?</div>

              {/* YES */}
              <button onClick={()=>onVote(user,"yes")} style={S.btnYes}>
                <span style={{fontSize:32}}>ğŸ¸</span>
                <div style={{textAlign:"left"}}>
                  <div style={{fontWeight:900, fontSize:18}}>Yes, I'm in!</div>
                  <div style={{fontSize:12, opacity:.7}}>Let's get those cocktails</div>
                </div>
              </button>

              {/* NO */}
              <button onClick={()=>onVote(user,"no")} style={S.btnNo}>
                <span style={{fontSize:32}}>ğŸ˜´</span>
                <div style={{textAlign:"left"}}>
                  <div style={{fontWeight:900, fontSize:18}}>Nah, not tonight</div>
                  <div style={{fontSize:12, opacity:.6}}>Early night for me</div>
                </div>
              </button>

              {/* HONEY */}
              <button onClick={()=>onVote(user,"honey")} style={S.btnHoney}>
                <svg width="44" height="44" viewBox="0 0 100 100" style={{flexShrink:0}}>
                  <ellipse cx="50" cy="65" rx="28" ry="24" fill="#E8923A"/>
                  <circle cx="50" cy="38" r="22" fill="#F4A820"/>
                  <circle cx="28" cy="20" r="10" fill="#F4A820"/>
                  <circle cx="72" cy="20" r="10" fill="#F4A820"/>
                  <circle cx="28" cy="20" r="6" fill="#E8923A"/>
                  <circle cx="72" cy="20" r="6" fill="#E8923A"/>
                  <circle cx="42" cy="35" r="4" fill="#1a0a00"/>
                  <circle cx="58" cy="35" r="4" fill="#1a0a00"/>
                  <circle cx="43" cy="33.5" r="1.5" fill="white"/>
                  <circle cx="59" cy="33.5" r="1.5" fill="white"/>
                  <ellipse cx="50" cy="42" rx="5" ry="3.5" fill="#c0683a"/>
                  <path d="M43 47 Q50 53 57 47" fill="none" stroke="#1a0a00" strokeWidth="2.5" strokeLinecap="round"/>
                  <rect x="38" y="73" width="24" height="20" rx="3" fill="#F9D342"/>
                  <rect x="38" y="73" width="24" height="7" rx="3" fill="#E8923A"/>
                  <text x="50" y="90" textAnchor="middle" fontSize="8" fontWeight="bold" fill="#6B3A1F">POT</text>
                  <path d="M22 58 Q30 68 38 76" fill="none" stroke="#F4A820" strokeWidth="6" strokeLinecap="round"/>
                  <path d="M78 58 Q70 68 62 76" fill="none" stroke="#F4A820" strokeWidth="6" strokeLinecap="round"/>
                </svg>
                <div style={{textAlign:"left"}}>
                  <div style={{fontWeight:900, fontSize:18, color:"#3d1f00"}}>I need the Honey ğŸ¯</div>
                  <div style={{fontSize:12, color:"#7a4a10"}}>Only if there's something sweet</div>
                </div>
              </button>
            </div>
          </div>
        </div>
      );
    }

    // â”€â”€ RESULTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function ResultsScreen({ user, votes, onVote }) {
      const yesVotes   = USERS.filter(u=>votes[u]==="yes");
      const noVotes    = USERS.filter(u=>votes[u]==="no");
      const honeyVotes = USERS.filter(u=>votes[u]==="honey");
      const pending    = USERS.filter(u=>!votes[u]);
      const allVoted   = pending.length===0;
      const goCount    = yesVotes.length + honeyVotes.length;

      if (votes[user]==="honey") {
        return (
          <div style={{...S.page, background:"#3d1f00"}}>
            <div style={{textAlign:"center", padding:"36px 24px 20px"}}>
              <img src={LOGO} alt="Ripsnorter" style={{width:140, filter:"brightness(0.8) sepia(1) hue-rotate(0deg) saturate(2)", opacity:.8}}/>
            </div>
            <div style={{flex:1, display:"flex", flexDirection:"column", alignItems:"center", padding:"0 24px 40px", animation:"fadeUp .35s ease forwards"}}>
              <div style={{textAlign:"center", marginBottom:24}}>
                <div style={{fontSize:80, animation:"shake 1.2s ease infinite", display:"inline-block"}}>ğŸ¯</div>
                <div style={{fontWeight:900, fontSize:34, color:"#F9D342", lineHeight:1.1, marginTop:8}}>Call the Honeyman!</div>
                <div style={{fontSize:14, color:"#c07020", marginTop:6}}>{user} needs their honey first...</div>
              </div>
              <div style={{...S.card, background:"rgba(255,255,255,.07)", border:"none", width:"100%"}}>
                {USERS.map(u=>{
                  const v=votes[u];
                  return (
                    <div key={u} style={{display:"flex",alignItems:"center",justifyContent:"space-between",
                      padding:"12px 0",borderBottom:"1px solid rgba(255,255,255,.06)"}}>
                      <span style={{fontWeight:700,color:u===user?"#F9D342":"#ccc",fontSize:16}}>{u}</span>
                      <span style={{fontSize:22}}>{v==="yes"?"ğŸ¸":v==="no"?"ğŸ˜´":v==="honey"?"ğŸ¯":"â³"}</span>
                    </div>
                  );
                })}
              </div>
              <button style={{...S.changeBtn, color:"#F9D342", borderColor:"rgba(249,211,66,.3)", marginTop:16}} onClick={()=>onVote(user,null)}>â† Change my vote</button>
            </div>
          </div>
        );
      }

      return (
        <div style={S.page}>
          <Header/>
          <div style={{flex:1, display:"flex", flexDirection:"column", alignItems:"center", padding:"0 24px 40px", maxWidth:420, margin:"0 auto", width:"100%", animation:"fadeUp .35s ease forwards"}}>

            {allVoted && (
              <div style={{...S.verdictBanner,
                background: goCount>=3?"#fff": goCount===2?"rgba(255,255,255,.15)":"rgba(0,0,0,.2)",
                animation:"pop .5s ease forwards"}}>
                <div style={{fontSize:36, marginBottom:4}}>
                  {goCount>=3?"ğŸ‰":goCount===2?"ğŸ¤”":"ğŸ’¤"}
                </div>
                <div style={{fontWeight:900, fontSize:24, color: goCount>=3?"#1e6b3a":"#fff"}}>
                  {goCount>=3?"WE'RE GOING!":goCount===2?"Maybe...":"Not tonight"}
                </div>
                <div style={{fontSize:13, color: goCount>=3?"#2d8a4e":"rgba(255,255,255,.6)", marginTop:4}}>
                  {yesVotes.length} yes Â· {honeyVotes.length} need honey Â· {noVotes.length} out
                </div>
              </div>
            )}

            {!allVoted && (
              <div style={S.waitingBanner}>
                <span style={{animation:"blink 1.2s ease infinite", display:"inline-block", color:"#fff"}}>â—</span>
                <span style={{fontSize:13, color:"rgba(255,255,255,.6)", fontWeight:700}}>
                  Waiting for {pending.join(", ")}...
                </span>
              </div>
            )}

            <div style={S.card}>
              <div style={{fontWeight:800, fontSize:12, color:"#999", letterSpacing:2, textTransform:"uppercase", marginBottom:12}}>Tonight's crew</div>
              {USERS.map(u=>{
                const v=votes[u], isYou=u===user;
                return (
                  <div key={u} style={{display:"flex",alignItems:"center",gap:12,padding:"12px 0",
                    borderBottom:"1px solid #f0f0f0"}}>
                    <div style={{flex:1}}>
                      <div style={{fontWeight:800,fontSize:16,color:"#111"}}>{u} {isYou&&<span style={{fontSize:11,color:"#1e6b3a",fontWeight:700}}>(you)</span>}</div>
                      <div style={{fontSize:12,fontWeight:700,marginTop:1,
                        color:v==="yes"?"#1e6b3a":v==="no"?"#999":v==="honey"?"#c07020":"#ccc"}}>
                        {v==="yes"?"In for tonight!":v==="no"?"Not tonight":v==="honey"?"Needs the honey ğŸ¯":"Deciding..."}
                      </div>
                    </div>
                    <span style={{fontSize:28}}>{v==="yes"?"ğŸ¸":v==="no"?"ğŸ˜´":v==="honey"?"ğŸ¯":"â³"}</span>
                  </div>
                );
              })}
            </div>

            <button style={S.changeBtn} onClick={()=>onVote(user,null)}>â† Change my vote</button>
          </div>
        </div>
      );
    }

    // â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function App() {
      const [user, setUser] = useState(null);
      const { votes, ready, castVote } = useVotes();

      if (!ready) return (
        <div style={{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",gap:16,background:"#1e6b3a"}}>
          <img src={LOGO} alt="Ripsnorter" style={{width:140, animation:"float 2s ease-in-out infinite"}}/>
          <div style={{color:"rgba(255,255,255,.4)",fontWeight:700,fontSize:13,letterSpacing:3}}>LOADING...</div>
        </div>
      );

      if (!user) return <PickUserScreen onPick={setUser}/>;
      return <VoteScreen user={user} votes={votes} onVote={castVote}/>;
    }

    // â”€â”€ STYLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const S = {
      page: {
        minHeight:"100vh", background:"#1e6b3a",
        display:"flex", flexDirection:"column",
      },
      card: {
        background:"#fff", borderRadius:20, padding:"20px",
        boxShadow:"0 8px 40px rgba(0,0,0,.15)",
        width:"100%", marginBottom:12,
      },
      userBtn: {
        display:"flex", alignItems:"center", justifyContent:"space-between",
        background:"#f7f7f7", border:"none", borderRadius:12,
        padding:"16px 18px", cursor:"pointer", fontFamily:"'DM Sans',sans-serif",
        color:"#111", fontWeight:800, fontSize:17, width:"100%",
      },
      btnYes: {
        display:"flex", alignItems:"center", gap:14, width:"100%", marginBottom:10,
        background:"#1e6b3a", border:"none", borderRadius:14,
        padding:"18px 20px", cursor:"pointer", fontFamily:"'DM Sans',sans-serif",
        color:"#fff", boxShadow:"0 4px 20px rgba(30,107,58,.4)",
      },
      btnNo: {
        display:"flex", alignItems:"center", gap:14, width:"100%", marginBottom:10,
        background:"#111", border:"none", borderRadius:14,
        padding:"18px 20px", cursor:"pointer", fontFamily:"'DM Sans',sans-serif",
        color:"#fff", boxShadow:"0 4px 20px rgba(0,0,0,.3)",
      },
      btnHoney: {
        display:"flex", alignItems:"center", gap:14, width:"100%",
        background:"linear-gradient(135deg,#F9D342,#F4A820)",
        border:"none", borderRadius:14,
        padding:"16px 20px", cursor:"pointer", fontFamily:"'DM Sans',sans-serif",
        boxShadow:"0 4px 20px rgba(249,211,66,.3)",
      },
      verdictBanner: {
        width:"100%", borderRadius:16, padding:"20px",
        textAlign:"center", marginBottom:12,
        border:"1px solid rgba(255,255,255,.2)",
      },
      waitingBanner: {
        width:"100%", background:"rgba(0,0,0,.2)", borderRadius:12,
        padding:"12px 16px", marginBottom:12,
        display:"flex", alignItems:"center", gap:10,
      },
      changeBtn: {
        background:"transparent", color:"rgba(255,255,255,.5)",
        border:"1px solid rgba(255,255,255,.2)", borderRadius:10,
        padding:"12px 20px", cursor:"pointer", fontFamily:"'DM Sans',sans-serif",
        fontSize:13, fontWeight:700, width:"100%", marginTop:4,
      },
    };

    function getTodayKey() {
      const d = new Date();
      return `${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`;
    }

    function useVotes() {
      const [votes, setVotes]   = useState({});
      const [ready, setReady]   = useState(false);
      useEffect(() => {
        let unsub;
        function subscribe() {
          const today = getTodayKey();
          unsub = window.__fsSnap(
            window.__fsDoc(window.__db, "botanero", today),
            snap => { setVotes(snap.exists() ? (snap.data().votes||{}) : {}); setReady(true); }
          );
          cleanOldVotes(today);
        }
        if (window.__fbReady) subscribe();
        else window.addEventListener("firebase-ready", subscribe, {once:true});
        return () => unsub && unsub();
      }, []);

      async function castVote(user, choice) {
        const today = getTodayKey();
        const newVotes = choice === null
          ? Object.fromEntries(Object.entries({...votes}).filter(([k])=>k!==user))
          : {...votes, [user]: choice};
        await window.__fsSet(window.__fsDoc(window.__db,"botanero",today),{votes:newVotes,date:today});
      }
      return { votes, ready, castVote };
    }

    async function cleanOldVotes(today) {
      try {
        const snap = await window.__fsGetDocs(window.__fsColl(window.__db,"botanero"));
        snap.forEach(d=>{ if(d.id!==today) window.__fsDel(window.__fsDoc(window.__db,"botanero",d.id)); });
      } catch {}
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
  </script>
</body>
</html>
